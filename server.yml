---

- hosts: all
  gather_facts: true
  become: true

  pre_tasks:
    - name: Install collections locally from requirements.yml file
      community.general.ansible_galaxy_install:
        type: collection
        requirements_file: requirements.yml
      delegate_to: localhost
      become: false

  tasks:
    - name: Run firewall playbook
      include: playbooks/firewall.yml

    - name: Enable automatic updated
      include: playbooks/automatic-updates.yml

    - name: Install packages
      include: playbooks/install-software.yml

    - include_role:
        name: '{{ roleinputvar }}'
      loop:
          - ssh
          - ansible-pull
          - wireguard
          - adguardhome
          - haproxy
      loop_control:
        loop_var: roleinputvar
